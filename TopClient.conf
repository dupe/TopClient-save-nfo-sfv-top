##Config LOGIN 
set topsite(****_user) ""
set topsite(****_pass) ""
set topsite(****_host) ""
set topsite(****_port) ""
##Config LFTP
set topsite(***_LFTP_CONFIG) "set net:timeout 5s"
##; set dns:max-retries 5; set dns:fatal-timeout 5s;set net:timeout 5s;set net:reconnect-interval-base 1; set ftp:ssl-protect-data yes;set net:persist-retries 1;set net:reconnect-interval-max 1; set net:max-retries 1;set ftp:ssl-allow yes;set ftp:ssl-auth TLS;set ftp:ssl-force yes;set ftp:ssl-protect-data yes;set ftp:ssl-protect-fxp yes;set ftp:ssl-protect-list yes"
##Config Donwload
set topsite(****_DL_SFV) "1"
set topsite(****_DL_NFO) "1"
set topsite(****_DL_M3U) "1"
set topsite(****_DL_JPG) "1"
set topsite(****_DL_CUE) "1"
set topsite(****_DL_SAMPLE) "1"
set topsite(****_DL_COVER) "1"
set topsite(****_DL_MP3) "1"
##Config CMD
set topsite(****_SITEPRE) "1"
set topsite(****_SITEPRE_TO_ADDPRE) "1"
set topsite(****_SITEPRE_TO_INFO) "1"
set topsite(****_NEWDIR) "1"
set topsite(****_MP3INFO) "1"
set topsite(****_FILEINFO) "1"
set topsite(****_ADDINFO) "1"
set topsite(****_ADDGINFO) "1"
set topsite(****_ADDURL) "1"
##Config Dynamic Section

set topsite(****_SECTION_1) "0DAY"
set topsite(****_SECTION_1_TODAY) "0DAY-today"
set topsite(****_SECTION_2) "EBOOK"
set topsite(****_SECTION_2_TODAY) "EBOOK-Month"
set topsite(****_SECTION_3) "FLAC"
set topsite(****_SECTION_3_TODAY) "FLAC-today"
set topsite(****_SECTION_4) "MP3"
set topsite(****_SECTION_4_TODAY) "MP3-today"
set topsite(****_SECTION_5) "MViD"
set topsite(****_SECTION_5_TODAY) "MViD-Month"
set topsite(****_SECTION_6) "XXX-0DAY"
set topsite(****_SECTION_6_TODAY) "XXX-0DAY-today"
set topsite(****_SECTION_7) "XXX-iMAGESETS"
set topsite(****_SECTION_7_TODAY) "XXX-iMAGESETS-today"

set topsite(****_SECTION_8) "ANiMES-FR"
set topsite(****_SECTION_8_TODAY) "ANiMES-FR"
set topsite(****_SECTION_9) "APPS"
set topsite(****_SECTION_9_TODAY) "APPS"
set topsite(****_SECTION_10) "BLURAY"
set topsite(****_SECTION_10_TODAY) "BLURAY"
set topsite(****_SECTION_11) "DVDR"
set topsite(****_SECTION_11_TODAY) "DVDR"
set topsite(****_SECTION_12) "DVDR-DE"
set topsite(****_SECTION_12_TODAY) "DVDR-DE"
set topsite(****_SECTION_13) "DVDR-ES"
set topsite(****_SECTION_13_TODAY) "DVDR-ES"
set topsite(****_SECTION_14) "DVDR-FR"
set topsite(****_SECTION_14_TODAY) "DVDR-FR"
set topsite(****_SECTION_15) "DVDR-NL"
set topsite(****_SECTION_15_TODAY) "DVDR-NL"
set topsite(****_SECTION_16) "DVDR-NORDiC"
set topsite(****_SECTION_16_TODAY) "DVDR-NORDiC"
set topsite(****_SECTION_17) "DVDR-iTA"
set topsite(****_SECTION_17_TODAY) "DVDR-iTA"
set topsite(****_SECTION_18) "GAMES"
set topsite(****_SECTION_18_TODAY) "GAMES"
set topsite(****_SECTION_19) "MBLURAY"
set topsite(****_SECTION_19_TODAY) "MBLURAY"
set topsite(****_SECTION_20) "MDVDR"
set topsite(****_SECTION_20_TODAY) "MDVDR"
set topsite(****_SECTION_21) "NDS"
set topsite(****_SECTION_21_TODAY) "NDS"
set topsite(****_SECTION_22) "PS3"
set topsite(****_SECTION_22_TODAY) "PS3"
set topsite(****_SECTION_23) "PSP"
set topsite(****_SECTION_23_TODAY) "PSP"
set topsite(****_SECTION_24) "TV-DVDR"
set topsite(****_SECTION_24_TODAY) "TV-DVDR"
set topsite(****_SECTION_25) "TV-HD"
set topsite(****_SECTION_25_TODAY) "TV-HD"
set topsite(****_SECTION_26) "TV-HD-DE"
set topsite(****_SECTION_26_TODAY) "TV-HD-DE"
set topsite(****_SECTION_27) "TV-HD-ES"
set topsite(****_SECTION_27_TODAY) "TV-HD-ES"
set topsite(****_SECTION_28) "TV-HD-FR"
set topsite(****_SECTION_28_TODAY) "TV-HD-FR"
set topsite(****_SECTION_29) "TV-HD-NL"
set topsite(****_SECTION_29_TODAY) "TV-HD-NL"
set topsite(****_SECTION_30) "TV-HD-NORDiC"
set topsite(****_SECTION_30_TODAY) "TV-HD-NORDiC"
set topsite(****_SECTION_31) "TV-HD-iTA"
set topsite(****_SECTION_31_TODAY) "TV-HD-iTA"
set topsite(****_SECTION_32) "TV-HDRiP"
set topsite(****_SECTION_32_TODAY) "TV-HDRiP"
set topsite(****_SECTION_33) "TV-SD"
set topsite(****_SECTION_33_TODAY) "TV-SD"
set topsite(****_SECTION_34) "TV-SD-DE"
set topsite(****_SECTION_34_TODAY) "TV-SD-DE"
set topsite(****_SECTION_35) "TV-SD-ES"
set topsite(****_SECTION_35_TODAY) "TV-SD-ES"
set topsite(****_SECTION_36) "TV-SD-FR"
set topsite(****_SECTION_36_TODAY) "TV-SD-FR"
set topsite(****_SECTION_37) "TV-SD-NL"
set topsite(****_SECTION_37_TODAY) "TV-SD-NL"
set topsite(****_SECTION_38) "TV-SD-NORDiC"
set topsite(****_SECTION_38_TODAY) "TV-SD-NORDiC"
set topsite(****_SECTION_39) "TV-SD-iTA"
set topsite(****_SECTION_39_TODAY) "TV-SD-iTA"
set topsite(****_SECTION_40) "TV-SDRiP"
set topsite(****_SECTION_40_TODAY) "TV-SDRiP"
set topsite(****_SECTION_41) "Wii"
set topsite(****_SECTION_41_TODAY) "Wii"
set topsite(****_SECTION_42) "X264"
set topsite(****_SECTION_42_TODAY) "X264"
set topsite(****_SECTION_43) "X264-DE"
set topsite(****_SECTION_43_TODAY) "X264-DE"
set topsite(****_SECTION_44) "X264-FR"
set topsite(****_SECTION_44_TODAY) "X264-FR"
set topsite(****_SECTION_45) "X264-NL"
set topsite(****_SECTION_45_TODAY) "X264-NL"
set topsite(****_SECTION_46) "X264-NORDiC"
set topsite(****_SECTION_46_TODAY) "X264-NORDiC"
set topsite(****_SECTION_47) "X264-iTA"
set topsite(****_SECTION_47_TODAY) "X264-iTA"
set topsite(****_SECTION_48) "XBOX360"
set topsite(****_SECTION_48_TODAY) "XBOX360"
set topsite(****_SECTION_49) "XViD"
set topsite(****_SECTION_49_TODAY) "XViD"
set topsite(****_SECTION_50) "XViD-DE"
set topsite(****_SECTION_50_TODAY) "XViD-DE"
set topsite(****_SECTION_51) "XViD-FR"
set topsite(****_SECTION_51_TODAY) "XViD-FR"
set topsite(****_SECTION_52) "XViD-NL"
set topsite(****_SECTION_52_TODAY) "XViD-NL"
set topsite(****_SECTION_53) "XViD-NORDiC"
set topsite(****_SECTION_53_TODAY) "XViD-NORDiC"
set topsite(****_SECTION_54) "XViD-iTA"
set topsite(****_SECTION_54_TODAY) "XViD-iTA"
set topsite(****_SECTION_55) "XXX"
set topsite(****_SECTION_55_TODAY) "XXX"
set topsite(****_SECTION_56) "XXX-DE"
set topsite(****_SECTION_56_TODAY) "XXX-DE"
set topsite(****_SECTION_57) "XXX-DVDR"
set topsite(****_SECTION_57_TODAY) "XXX-DVDR"
set topsite(****_SECTION_58) "XXX-ES"
set topsite(****_SECTION_58_TODAY) "XXX-ES"
set topsite(****_SECTION_59) "XXX-FR"
set topsite(****_SECTION_59_TODAY) "XXX-FR"
set topsite(****_SECTION_60) "XXX-HD"
set topsite(****_SECTION_60_TODAY) "XXX-HD"
set topsite(****_SECTION_61) "XXX-iTA"
set topsite(****_SECTION_61_TODAY) "XXX-iTA"


namespace eval ::topclient {
	#Config bot per bot

	#Si le botnet-nick à pas été renseigné dans le fichiers configuration, on recherche le nick IRC du bot :
	if { [info exists ::botnet-nick] } { 
		if { ${::botnet-nick} == "" } { set ::who_name ${::nick}; } else { set ::who_name ${::botnet-nick}; }
	} else { set ::who_name ${::nick}; }

	switch -exact -- [string tolower $who_name] {
		shass  {
			# Si vous dsirer avoir un echo sur les channels des commandes
			# renseignez les channels, sinon mettez "" :
			set top_config(chan_debug) ""
			set top_config(chan_addpre) ""
			set top_config(chan_newdir) ""
			set top_config(chan_addinfo) ""
			set top_config(chan_addginfo) ""
			set top_config(chan_sitepre) ""
			set top_config(chan_mp3info) ""
			set top_config(chan_fileinfo) ""
			set top_config(chan_addnfo) ""
			set top_config(chan_addm3u) ""
			set top_config(chan_style) ""
			set top_config(chan_addjpg) ""
			set top_config(chan_addcue) ""
			set top_config(chan_addsfv) ""
			set top_config(chan_addcover) ""
			set top_config(chan_addvideoinfo) ""
            set top_config(chan_addmediainfo) ""
			set top_config(chan_addurl) ""
			set top_config(chan_req) ""

			### Configuration MySQL
			set sql_config(Host) "127.0.0.1"
			set sql_config(Port) ""
			set sql_config(User) "root"
			set sql_config(Pass) ""
			set sql_config(DBName) ""

			# Si vous utilisez un botnet (plusieurs eggdrop relier entre eux)
			# Renseign le le nom du bot link qui devra recevoir toutes les commandes
			#
			##Entrer le bot ou les commandes seront envoyers  :
                        set top_config(bot_dest) "all"
			# top_config(debug_ppl) Permet d'activé ou désactiver les annonces dans le ppl de votre EGG
			# Mettez 1 pour activer et 0 pour désactiver
			set top_config(debug_ppl) "1"

			#Skip list for dirname :
			set skipdirname "*-30CD* *Isanaki* *-G2K *-G0LDz *insecure* *bustme* *crapsite* *KiMSUFi* *SCENECLEAN* *NUKED* TEST* req-* req* archive* backup* affil* request* *P2P* *XXX-PAYSiTE*"

			#Skip list for section :
			set skipsection "*NUKED* req-* req* backup* affil* request* filled* *P2P* _STAFF _PRE SCENE-NEWS"
####set skipsection "*NUKED* req-* req* backup* affil* filled* *P2P* _ARCHIVE _STAFF _PRE SCENE-NEWS"

			#Skip list for files :
			set skipfile "*.diz *.confict *.imdb *.date *.bad *.message *-offline *.racestats *-HORS-LIGNE *sfvdb* *(1)* *(2)* *(3)* *(4)* *(5)* *(6)* *(7)*"
		}
		default {
			die "\n\n\ncouldn't find my botnick ${nick} in configuration of Topclient\n\n\n"
		}
	}
}
package require http
package require tls
package require crc32
package require md5

#####################################
#
# top_config(lftp) contient le chemin complet lftp.
# lftp permet de ce connecté aux differents serveurs FTP
# Il doit tre imprativement installer.
# Renseigné sont chemmin :
set top_config(lftp) "/usr/bin/lftp";

#####################################
#
# Le package CRC est contenue dans apt-get install tcllib
# Si vous desirez indiquez vous meme le chemin de CRC32.tcl
# Renseigné sont chemmin :
#####################################
#
# Le package HTTP est contenue dans apt-get install tcllib
# Si vous desirez indiquez vous meme le chemin de HTTP.tcl
# Renseigné sont chemmin :
###set tcl_package(http) "/usr/share/tcltk/tcl8.4/http2.7.5/http.tcl";
#set tcl_package(http) "/usr/share/tcltk/tcl8.4/http2.5/http.tcl"
#####################################
#
# Le package tls est contenue dans apt-get install tcltls
# Si vous desirez indiquez vous meme le chemin de TLS.tcl
# Renseigné sont chemmin :
###set tcl_package(tls) "/usr/share/tcltk/tls1.50/tls.tcl";
#tcl_package(tls) "/usr/share/tcltk/tls1.50/tls.tcl"
#####################################
#
# top_config(ffmpeg) contient le chemin complet FFmpeg.
# FFmpeg permet de convertir les .avi en JPG pour addcover
# Il doit tre imprativement installer.
# Renseigné sont chemmin :
set top_config(ffmpeg) "/usr/bin/ffmpeg";

#####################################
#
# top_config(www) contient le chemin complet au rpetoire
# www qui contiendra les differents fichiers qui seront
# accesible par HTTP. Cela permet de partag les NFO's, etc
# Ne doit pas ce terminer par /
#
# Entrer le chemin du repertoire :
set top_config(www) "/var/www/tt";

#####################################
#
# top_config(www_dns) contient l'adresse url (sans http://) 
# de votre site web. Cela permet de partag les NFO's, etc
# Vous pouvez mettre l'IP ou un DNS, le port est facul
##Entrer le DNS du host apache (+ port) :
set top_config(www_dns) "predbdupenfo.doesntexist.com";


#####################################
#
# top_config(www_path) est le chemin de votre repetoire top_config(www) en HTTP
# Permet acumul a top_config(www_dns) de partag les NFO's, etc
# Ne doit pas ce terminer par / si c'est directement a la racine mettez ""
#
# Entrer me chemin pour l'url :
set top_config(www_path) "/tt";

#
#################################
# Global Variable
#################################
##

#####################################
# Informations :
#	Vous avez deux solutions pour faire fonctionné ce TCL correctement :
#
#	1) Mettre le Eggdrop sur un channel, et ensuite sur ce channel
#	   lancé les commandes :
#
#		!topcomplete <top_name> <release_name> <release_section> [release_file] [release_size]
#		!topnew <top_name> <release_name> <release_section>
#		!toppre <top_name> <release_name> <release_section> [release_file] [release_size]
#
#	2) Mettre le eggdrop sur tout les topsites et configurer pour
#	   que ce TCL ce lance pour chaque commandes :
#
#		proc_topcomplete $nick $uhost $hand $chan "<top_name> <release_name> <release_section> [release_file] [release_size]"
#		proc_topnew $nick $uhost $hand $chan "<top_name> <release_name> <release_section>"
#		proc_toppre $nick $uhost $hand $chan "<top_name> <release_name> <release_section> [release_file] [release_size]"
#
#	Toutes les données entre <> sont obligatoire, et ceux entre [] sont optionnels laissez vide ou remplacé par un tiret -
#
#####################################
##Site planet
bind PUBM -|- * proc_annonce_top
#####################################
# proc_annonce_top                  #
#####################################
proc proc_annonce_top { nick uhost hand chan arg } {

	###### INIT - BEGIN ######
	set arg [string map {"" ""} [stripcodes bcu $arg]]
	###### INIT - END ######
# SITE ****
        set site_name "***";
        #if { $nick != "***" } { return 0; }
        #Pre affils annonce..
        if { [string match "*pre*" [string tolower [lindex $arg 0]]] && [string match "*pre!*" [string tolower [lindex $arg 8]]] && [string match "*has*" [string tolower [lindex $arg 10]]] } {
                set release_name [lindex $arg 9]
                set release_section [lindex $arg 2]
                set release_section [string range $release_section 1 end-1]
                set release_file "-";
                set release_size "-";
                if { $::topclient::top_config(chan_debug) != "" } { putfast "privmsg $::topclient::top_config(chan_debug) :\0034$site_name\003 -> (\00310PRE\003):\0037 $release_name $release_section $release_file $release_size"; }
                proc_toppre $nick $uhost $hand $chan "$site_name $release_name $release_section $release_file $release_size";
                return 0;
        }

        #New annonce..
        if { [string match "*new*" [string tolower [lindex $arg 0]]] && [string match "*by*" [string tolower [lindex $arg 4]]] } {
                set release_name [lindex $arg 3]
                set release_section [lindex $arg 2]
                set release_section [string range $release_section 1 end-1]
#                set release_section [string range $release_section 0 end-1]
                if  {$::topclient::top_config(chan_debug) != "" } { putfast "privmsg $::topclient::top_config(chan_debug) :\0034$site_name\003 -> (\00310NEW\003):\0037 $release_name $release_section"; }
                proc_topnew $nick $uhost $hand $chan "$site_name $release_name $release_section";
                return 0;
        }


        #Complete annonce..
        if { [string match "*done*" [string tolower [lindex $arg 0]]]} {
                set release_name [lindex $arg 2]
                set release_section [lindex $arg 1]
                set release_section [string range $release_section 1 end-1]
#                set release_section [string range $release_section 0 end-1]
                set release_file "-";
                set release_size "-";
                if { $::topclient::top_config(chan_debug) != "" } { putfast "privmsg $::topclient::top_config(chan_debug) :\0034$site_name\003 -> (\00310COMPLETE\003):\0037 $release_name $release_section $release_file $release_size"; }
                proc_topcomplete $nick $uhost $hand $chan "$site_name $release_name $release_section $release_file $release_size";
                return 0;

        }
}

proc putfast {arg} {
append arg "\n"
putdccraw 0 [string length $arg] $arg
}
